<%# Show chat link when request is in progress and user is participant %>
<% if request.in_progress? && accepted_offer %>
  <% if user_signed_in? && (request.user == current_user || accepted_offer.user == current_user) %>
    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-2 border-blue-300 dark:border-blue-700 rounded-lg p-6 mb-6 shadow-sm hover:shadow-md transition-shadow">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <div class="flex items-center mb-2">
            <div class="flex-shrink-0 mr-3">
              <div class="bg-blue-600 dark:bg-blue-700 rounded-full p-2">
                <%= icon_tag(:message, class: "w-6 h-6 text-white") %>
              </div>
            </div>
            <div>
              <h3 class="text-xl font-bold text-gray-900 dark:text-gray-100">
                <%= t('requests.show.chat_with', username: (request.user == current_user ? accepted_offer.user.username : request.user.username)) %>
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                <%= t('requests.show.chat_description') %>
              </p>
            </div>
          </div>
        </div>

        <%= link_to request_conversation_path(request),
            class: "ml-4 inline-flex items-center px-6 py-3 bg-blue-600 dark:bg-blue-700 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-800 hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200" do %>
          <%= icon_tag(:message, class: "w-5 h-5 mr-2") %>
          <%= t('requests.show.open_chat') %>
          <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
