<div class="container mx-auto px-4 py-8 max-w-3xl">
  <div class="mb-4">
    <%= link_to "← Назад ко всем диалогам", admin_messages_path, class: "text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400" %>
  </div>

  <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6">Диалог с <%= @admin_thread_user.username %> (Админ)</h1>

  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md">
    <div class="p-6 space-y-4 h-96 overflow-y-auto">
      <% @messages.each do |message| %>
        <% is_current_user = message.sender_id == current_user.id %>
        <div class="flex <%= is_current_user ? 'justify-end' : 'justify-start' %>">
          <div class="flex items-start gap-3 max-w-md">
            <% unless is_current_user %>
              <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-600 dark:bg-indigo-700 flex items-center justify-center">
                <span class="text-white font-semibold"><%= message.sender.username[0].upcase %></span>
              </div>
            <% end %>

            <div class="p-3 rounded-lg <%= is_current_user ? 'bg-indigo-600 dark:bg-indigo-700 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100' %>">
              <p class="text-sm"><%= message.body %></p>
              <p class="text-xs mt-1 <%= is_current_user ? 'text-indigo-200 dark:text-indigo-300' : 'text-gray-500 dark:text-gray-400' %>">
                <%= message.created_at.strftime("%b %d, %H:%M") %>
              </p>
            </div>

            <% if is_current_user %>
              <div class="flex-shrink-0 h-8 w-8 rounded-full bg-blue-600 dark:bg-blue-700 flex items-center justify-center">
                <span class="text-white font-semibold"><%= current_user.username[0].upcase %></span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800">
      <%= form_with(model: @new_message, url: admin_messages_path, class: "flex items-start space-x-3") do |f| %>

        <% if @new_message.errors.any? %>
          <div class="w-full text-red-600 dark:text-red-400 text-sm mb-2">
            <%= @new_message.errors.full_messages.to_sentence %>
          </div>
        <% end %>

        <%= f.hidden_field :recipient_id, value: @admin_thread_user.id %>

        <%= f.text_area :body,
            rows: 2,
            class: "flex-1 block w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-100 dark:placeholder-gray-400 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",
            placeholder: "Напишите ваш ответ..." %>

        <%= f.submit "Отправить", class: "px-4 py-2 bg-indigo-600 dark:bg-indigo-700 text-white rounded-md hover:bg-indigo-700 dark:hover:bg-indigo-600 cursor-pointer" %>
      <% end %>
    </div>
  </div>
</div>
